<!doctype html>
<head>
<html lang="sv">
  <meta charset="utf-8">
  <title>OAuth Redirect - Vaccination MAUI</title>
  <!-- Add 'android' class early to avoid UI flash on Android -->
  <script>if (/Android/i.test(navigator.userAgent)) { document.documentElement.classList.add('android'); }</script>
  <style>
    body { font-family: Arial, sans-serif; text-align:center; padding:50px; background:#f5f5f5; margin:0 }
    .container { background:#fff; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1); max-width:500px; margin:40px auto }
    .success { color:#28a745; font-size:24px; margin-bottom:20px }
    .cancelled { color:#dc3545; font-size:24px; margin-bottom:20px }
    .error { color:#dc3545; font-size:24px; margin-bottom:20px }
    .message { color:#666; margin-bottom:20px }
    .btn { background:#007bff; color:#fff; border:0; padding:10px 20px; border-radius:5px; cursor:pointer; font-size:16px; margin:5px }
    .btn:hover { background:#0056b3 }
    /* Hide only on Android to avoid UI flash there */
    html.android body { display:none }
  </style>
  <script>
    (function () {
      var params = window.location.search || "";
      var deepLink = "vaccinationmaui://oauth2redirect" + params;
      var isAndroid = document.documentElement.classList.contains("android");
      
      // Parse URL parameters to determine the OAuth result
      var urlParams = new URLSearchParams(params);
      var error = urlParams.get('error');
      var code = urlParams.get('code');
      
      // Determine the message to show
      var statusClass = 'success';
      var statusTextSwe = '✅ Autentisering lyckades!';
      var messageTextSwe = 'Du har framgångsrikt loggat in på Vaccinationsjournalen.<br>Klicka på knappen nedan för att gå tillbaka till appen.';
      var buttonTextSwe = 'Åter till appen';
      var statusText = '✅ Authentication Successful!';
      var messageText = 'You have successfully signed in to Vaccination Journal.<br>Click the button below to return to the app.';
      var buttonText = 'Return to App';
      
      if (error === 'access_denied') {
        statusClass = 'cancelled';
        statusText = '❌ Authentication Cancelled';
        messageText = 'The sign-in process was cancelled by the user.<br>You can close this tab and return to your app.';
        buttonText = 'Return to App';
      } else if (error) {
        statusClass = 'error';
        statusText = '❌ Authentication Error';
        messageText = 'An error occurred during the sign-in process.<br>Please try again.';
        buttonText = 'Try Again';
      } else if (!code) {
        statusClass = 'error';
        statusText = '❌ Invalid Response';
        messageText = 'No authentication code received.<br>Please try again.';
        buttonText = 'Try Again';
      }

      if (isAndroid) {
        // ANDROID: redirect immediately, no flash
        window.location.replace(deepLink);
        // Fallback if app doesn't open quickly
        setTimeout(function () {
          document.documentElement.classList.remove("android");
          document.body.innerHTML =
            "<div class='container'><div class='message'>If your app did not open, please install it and try again.</div></div>";
        }, 1200);
      } else {
        // WINDOWS/others: show UI and redirect immediately
        window.addEventListener("DOMContentLoaded", function () {
          // Update the UI based on the OAuth result
          document.getElementById("statusText").className = statusClass;
          document.getElementById("statusText").innerHTML = statusText;
          document.getElementById("messageText").innerHTML = messageText;
          document.getElementById("returnBtn").innerHTML = buttonText;
          
          document.getElementById("returnBtn").onclick = function () { window.location.href = deepLink; };
          
          // Redirect immediately - no delay needed
          window.location.href = deepLink;
        });
      }
    })();
  </script>
</head>
<body>
  <div class="container">
    <div id="statusText" class="success">✅ Authentication Successful!</div>
    <div id="messageText" class="message">You have successfully signed in.<br>Click the button below to return to your app.</div>
    <button class="btn" id="returnBtn">Return to App</button>
  </div>
</body>
</html>




